{"version":3,"sources":["../index.js"],"names":["configure","$toggle","$unset","$splice","$push","$unshift","$pop","$shift","$sort","$remove","$swap","$merge","$set","updatePath","define","configs","separator","Array","prototype","arraySlice","slice","arrayShift","shift","arrayUnshift","unshift","arrayPush","push","arrayPop","pop","arraySplice","splice","arraySort","sort","newConfigs","Object","assign","Immutable","value","parent","path","children","childMap","modifier","args","call","arguments","actions","Error","newValue","apply","concat","change","changed","isPlainObject","x","child","split","reduce","current","props","length","clone","prop","forEach","arrayOp","array","index","count","newItems","sorter","val","constructor","items","newArray","filter","indexOf","from","to","temp","obj","values","mergedObj","undefined","key","createSelectorProxy","proxy","Proxy","get","target","traversal","node","entries","pair","Function","childFromPath","spec","keys","newChild","update","state","changes","root","specs","selector","merge","remove","set","toggle","unset","swap","name","action"],"mappings":"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","file":"index.js","sourcesContent":["const configs = {\r\n  separator: '.'\r\n};\r\n\r\nconst {\r\n  slice: arraySlice,\r\n  shift: arrayShift,\r\n  unshift: arrayUnshift,\r\n  push: arrayPush,\r\n  pop: arrayPop,\r\n  splice: arraySplice,\r\n  sort: arraySort\r\n} = Array.prototype;\r\n\r\nexport function configure(newConfigs) {\r\n  Object.assign(configs, newConfigs);\r\n}\r\n\r\nclass Immutable {\r\n  constructor(value, parent, path) {\r\n    this.parent = parent;\r\n    this.value = value;\r\n    this.path = path;\r\n    this.children = [];\r\n    this.childMap = {};\r\n  }\r\n\r\n  apply(modifier) {\r\n    const args = arraySlice.call(arguments, 1);\r\n    if (typeof modifier === 'string') {\r\n      if (modifier in actions) {\r\n        modifier = actions[modifier];\r\n      } else {\r\n        throw new Error(`No action '${modifier}'' defined`);\r\n      }\r\n    }\r\n    const newValue = modifier.apply(null, [this.value].concat(args));\r\n    if (newValue !== this.value) {\r\n      this.value = newValue;\r\n      this.change();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  change() {\r\n    if (!this.changed) {\r\n      this.changed = true;\r\n      if (this.value instanceof Array) {\r\n        this.value = this.value.slice();\r\n      } else if (isPlainObject(this.value)) {\r\n        this.value = Object.assign({}, this.value);\r\n      }\r\n    }\r\n\r\n    for (let x of this.children) {\r\n      this.value[x.path] = x.value;\r\n    }\r\n\r\n    if (this.parent) {\r\n      this.parent.change();\r\n    }\r\n  }\r\n\r\n  child(path) {\r\n    if (path in this.childMap) {\r\n      return this.childMap[path];\r\n    }\r\n    const child = new Immutable(this.value[path], this, path);\r\n    this.children.push(child);\r\n    this.childMap[path] = child;\r\n    return child;\r\n  }\r\n\r\n  childFromPath(path) {\r\n    return (path instanceof Array\r\n        ? path\r\n        : path.split(configs.separator)\r\n    ).reduce((parent, path) => parent.child(path), this);\r\n  }\r\n}\r\n\r\nexport function $toggle(current) {\r\n  const props = arraySlice.call(arguments, 1);\r\n  if (!props.length) {\r\n    return !current;\r\n  }\r\n  const newValue = clone(current);\r\n  for (let prop of props) {\r\n    newValue[prop] = !newValue[prop];\r\n  }\r\n  return newValue;\r\n}\r\n\r\nexport function $unset(current) {\r\n  const props = arraySlice.call(arguments, 1);\r\n  if (!current) return;\r\n  let newValue = current;\r\n  props.forEach(prop => {\r\n    if (prop in newValue) {\r\n      if (newValue === current) {\r\n        newValue = clone(current);\r\n      }\r\n      delete newValue[prop];\r\n    }\r\n  });\r\n\r\n  return newValue;\r\n}\r\n\r\nfunction arrayOp(array, modifier) {\r\n  if (!array) {\r\n    array = [];\r\n  } else {\r\n    array = array.slice();\r\n  }\r\n  modifier(array);\r\n  return array;\r\n}\r\n\r\nexport function $splice(array, index, count) {\r\n  const newItems = arraySlice.call(arguments, 3);\r\n  if (newItems.length || count) {\r\n    return arrayOp(array, x =>\r\n      arraySplice.apply(x, [index, count].concat(newItems))\r\n    );\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $push(array) {\r\n  const newItems = arraySlice.call(arguments, 1);\r\n  if (newItems.length) {\r\n    return arrayOp(array, x => arrayPush.apply(x, newItems));\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $unshift(array) {\r\n  const newItems = arraySlice.call(arguments, 1);\r\n  if (newItems.length) {\r\n    return arrayOp(array, x => arrayUnshift.apply(x, newItems));\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $pop(array) {\r\n  if (!array || array.length) {\r\n    return arrayOp(array, x => x.pop());\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $shift(array) {\r\n  if (!array || array.length) {\r\n    return arrayOp(array, x => x.shift());\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $sort(array, sorter) {\r\n  return arrayOp(array, x => x.sort(sorter));\r\n}\r\n\r\nfunction clone(value) {\r\n  if (value instanceof Array) return value.slice();\r\n  return Object.assign({}, value);\r\n}\r\n\r\nconst isPlainObject = val =>\r\n  !!val && typeof val === 'object' && val.constructor === Object;\r\n\r\nexport function $remove(array) {\r\n  const items = arraySlice.call(arguments, 1);\r\n  const newArray = array.filter(x => items.indexOf(x) === -1);\r\n  return newArray.length === array.length ? array : newArray;\r\n}\r\n\r\nexport function $swap(current, from, to) {\r\n  const newValue = clone(current);\r\n  const temp = newValue[from];\r\n  newValue[from] = newValue[to];\r\n  newValue[to] = temp;\r\n  return newValue;\r\n}\r\n\r\nexport function $merge(obj) {\r\n  const values = arraySlice.call(arguments, 1);\r\n  if (values.length) {\r\n    let mergedObj = obj;\r\n    values.forEach(value => {\r\n      if (value === null || value === undefined) return;\r\n      for (let key in value) {\r\n        if (value[key] !== mergedObj[key]) {\r\n          if (mergedObj === obj) {\r\n            mergedObj = Object.assign({}, obj);\r\n          }\r\n          mergedObj[key] = value[key];\r\n        }\r\n      }\r\n    });\r\n    return mergedObj;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nfunction createSelectorProxy(path) {\r\n  const proxy = new Proxy(\r\n    {},\r\n    {\r\n      get(target, prop) {\r\n        path.push(prop);\r\n        return proxy;\r\n      }\r\n    }\r\n  );\r\n  return proxy;\r\n}\r\n\r\nexport function $set(current) {\r\n  const args = arraySlice.call(arguments, 1);\r\n  if (args.length < 2) {\r\n    return args[0];\r\n  }\r\n  // don't use destructing to improve performance\r\n  const prop = args[0];\r\n  const value = args[1];\r\n  const newValue = clone(current);\r\n  newValue[prop] = value;\r\n  return newValue;\r\n}\r\n\r\nfunction traversal(parent, node) {\r\n  for (let pair of Object.entries(node)) {\r\n    const key = pair[0];\r\n    let value = pair[1];\r\n    // convert obj method to custom modifier\r\n    if (value instanceof Function) {\r\n      value = [value];\r\n    }\r\n    const child = parent.childFromPath(key);\r\n    if (value instanceof Array) {\r\n      // is spec\r\n      if (value[0] instanceof Function || typeof value[0] === 'string') {\r\n        // is modifier and its args\r\n        child.apply.apply(child, value);\r\n      } else {\r\n        // is sub spec\r\n        const spec = value[0];\r\n        if (spec instanceof Array) {\r\n          // apply for each child\r\n          for (let key of Object.keys(child.value)) {\r\n            const newChild = child.child(key);\r\n            newChild.apply.apply(newChild, spec);\r\n          }\r\n        } else {\r\n          for (let key of Object.keys(child.value)) {\r\n            traversal(child.child(key), spec);\r\n          }\r\n        }\r\n      }\r\n    } else if (isPlainObject(value)) {\r\n      traversal(child, value);\r\n    } else {\r\n      child.apply($set, value);\r\n    }\r\n  }\r\n}\r\n\r\nexport const update = (state, changes) => {\r\n  const root = new Immutable(state);\r\n\r\n  if (changes instanceof Array) {\r\n    root.apply.apply(root, changes);\r\n  } else {\r\n    traversal(root, changes);\r\n  }\r\n\r\n  return root.value;\r\n};\r\n\r\nexport function updatePath(state, ...specs) {\r\n  const root = new Immutable(state);\r\n\r\n  for (let spec of specs) {\r\n    const selector = spec[0];\r\n    const args = spec.slice(1);\r\n    const path = [];\r\n    selector(createSelectorProxy(path));\r\n    const node = path.length ? root.childFromPath(path) : root;\r\n    node.apply.apply(node, args);\r\n  }\r\n\r\n  return root.value;\r\n}\r\n\r\nexport default update;\r\n\r\nexport const actions = {\r\n  $merge,\r\n  merge: $merge,\r\n  $pop,\r\n  pop: $pop,\r\n  $push,\r\n  push: $push,\r\n  $remove,\r\n  remove: $remove,\r\n  $set,\r\n  set: $set,\r\n  $shift,\r\n  shift: $shift,\r\n  $sort,\r\n  sort: $sort,\r\n  $splice,\r\n  splice: $splice,\r\n  $toggle,\r\n  toggle: $toggle,\r\n  $unset,\r\n  unset: $unset,\r\n  $unshift,\r\n  unshift: $unshift,\r\n  $swap,\r\n  swap: $swap\r\n};\r\n\r\nexport function define(name, action) {\r\n  if (isPlainObject(name)) {\r\n    Object.assign(actions, action);\r\n  } else {\r\n    actions[name] = action;\r\n  }\r\n}\r\n"]}