{"version":3,"sources":["../index.js"],"names":["configure","$toggle","$unset","$splice","$removeAt","$push","$unshift","$pop","$shift","$sort","$remove","$swap","$assign","$set","$batch","updatePath","define","configs","separator","Array","prototype","arraySlice","slice","arrayShift","shift","arrayUnshift","unshift","arrayPush","push","arrayPop","pop","arraySplice","splice","arraySort","sort","newConfigs","Object","assign","Immutable","value","parent","path","children","childMap","modifier","args","call","arguments","actions","Error","job","Function","apply","newValue","concat","change","valueUpdated","length","changed","clone","x","newChildren","filter","child","split","reduce","current","props","prop","node","forEach","arrayOp","array","index","count","newItems","indexes","newArray","sorter","undefined","isPlainObject","val","constructor","items","indexOf","from","to","temp","obj","values","mergedObj","key","createSelectorProxy","context","proxy","Proxy","get","target","set","thisArg","action","backToParent","processSubSpec","spec","keys","newChild","traversal","entries","pair","childFromPath","update","state","changes","root","specs","selector","__context__","batch","remove","toggle","unset","swap","removeAt","cloneIfPossible","callback","name","disableAutoClone"],"mappings":"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","file":"index.js","sourcesContent":["const configs = {\r\n  // for fast performance, we process dot as separator only\r\n  separator: \".\"\r\n};\r\n\r\nconst {\r\n  slice: arraySlice,\r\n  shift: arrayShift,\r\n  unshift: arrayUnshift,\r\n  push: arrayPush,\r\n  pop: arrayPop,\r\n  splice: arraySplice,\r\n  sort: arraySort\r\n} = Array.prototype;\r\n\r\nexport function configure(newConfigs) {\r\n  Object.assign(configs, newConfigs);\r\n}\r\n\r\nclass Immutable {\r\n  constructor(value, parent, path) {\r\n    this.parent = parent;\r\n    this.value = value;\r\n    this.path = path;\r\n    this.children = [];\r\n    this.childMap = {};\r\n  }\r\n\r\n  apply(modifier) {\r\n    const args = arraySlice.call(arguments, 1);\r\n    if (typeof modifier === \"string\") {\r\n      if (modifier in actions) {\r\n        modifier = actions[modifier];\r\n      } else {\r\n        throw new Error(`No action '${modifier}'' defined`);\r\n      }\r\n    }\r\n\r\n    // is batch processing\r\n    if (modifier === $batch) {\r\n      for (let job of args) {\r\n        if (job instanceof Function) {\r\n          job = [job];\r\n        }\r\n        this.apply.apply(this, job);\r\n      }\r\n      return this;\r\n    }\r\n\r\n    let newValue = modifier.apply(null, [this.value].concat(args));\r\n\r\n    // need special context\r\n    if (newValue instanceof Function) {\r\n      newValue = newValue(this);\r\n    }\r\n\r\n    if (newValue !== this.value) {\r\n      this.value = newValue;\r\n      this.change(true);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  change(valueUpdated) {\r\n    // notify to parent that child value is changed\r\n    if (this.parent) {\r\n      this.parent.change();\r\n    }\r\n\r\n    if (this.children.length) {\r\n      // if this is parent, we must clone its value\r\n      if (!this.changed) {\r\n        this.changed = true;\r\n        this.value = clone(this.value);\r\n        for (let x of this.children) {\r\n          if (x.parent === this) {\r\n            this.value[x.path] = x.value;\r\n          }\r\n        }\r\n      } else if (valueUpdated) {\r\n        const newChildren = [];\r\n        for (let x of this.children) {\r\n          if (x.parent === this && x.path in this.value) {\r\n            x.value = this.value[x.path];\r\n            newChildren.push(x);\r\n          } else {\r\n            // child is removed, so we detach the child\r\n            delete x.parent;\r\n            delete this.childMap[x.path];\r\n          }\r\n        }\r\n        this.children = newChildren;\r\n      }\r\n    }\r\n\r\n    // update parent model\r\n    if (this.parent) {\r\n      this.parent.value[this.path] = this.value;\r\n    }\r\n  }\r\n\r\n  backToParent() {\r\n    // make sure child should be removed fron its parent\r\n    this.parent.children = this.parent.children.filter(x => x !== this);\r\n    delete this.parent.childMap[this.path];\r\n    return this.parent;\r\n  }\r\n\r\n  child(path) {\r\n    if (path in this.childMap) {\r\n      return this.childMap[path];\r\n    }\r\n    const child = new Immutable(this.value[path], this, path);\r\n    this.children.push(child);\r\n    this.childMap[path] = child;\r\n    return child;\r\n  }\r\n\r\n  childFromPath(path) {\r\n    return (path instanceof Array\r\n      ? path\r\n      : path.split(configs.separator)\r\n    ).reduce((parent, path) => parent.child(path), this);\r\n  }\r\n}\r\n\r\nexport function $toggle(current) {\r\n  const props = arraySlice.call(arguments, 1);\r\n  if (!props.length) {\r\n    return !current;\r\n  }\r\n  const newValue = clone(current);\r\n  for (let prop of props) {\r\n    newValue[prop] = !newValue[prop];\r\n  }\r\n  return newValue;\r\n}\r\n\r\nexport function $unset(current) {\r\n  const props = arraySlice.call(arguments, 1);\r\n  // no prop to unset => unset its self\r\n  if (!props.length) {\r\n    return function(node) {\r\n      const parent = node.parent;\r\n      if (!parent) {\r\n        return current;\r\n      }\r\n\r\n      if (node.path in parent.value) {\r\n        if (!parent.changed) {\r\n          parent.value = clone(parent.value);\r\n        }\r\n        if (parent.value instanceof Array) {\r\n          parent.value.splice(node.path, 1);\r\n        } else {\r\n          delete parent.value[node.path];\r\n        }\r\n        delete node.parent;\r\n        parent.change(true);\r\n      } else {\r\n        // not exist in parent value\r\n      }\r\n    };\r\n  }\r\n\r\n  if (!current) return;\r\n  let newValue = current;\r\n  props.forEach(prop => {\r\n    if (prop in newValue) {\r\n      if (newValue === current) {\r\n        newValue = clone(current);\r\n      }\r\n      delete newValue[prop];\r\n    }\r\n  });\r\n\r\n  return newValue;\r\n}\r\n\r\nfunction arrayOp(array, modifier) {\r\n  if (!array) {\r\n    array = [];\r\n  } else {\r\n    array = array.slice();\r\n  }\r\n  modifier(array);\r\n  return array;\r\n}\r\n\r\nexport function $splice(array, index, count) {\r\n  const newItems = arraySlice.call(arguments, 3);\r\n  if (newItems.length || count) {\r\n    return arrayOp(array, x =>\r\n      arraySplice.apply(x, [index, count].concat(newItems))\r\n    );\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $removeAt(array) {\r\n  const indexes = arraySlice.call(arguments, 1);\r\n  let newArray = array;\r\n  // remove from bottom to top\r\n  indexes.sort();\r\n  while (indexes.length) {\r\n    const index = indexes.pop();\r\n    if (index >= 0 && index < newArray.length) {\r\n      if (newArray === array) {\r\n        newArray = newArray.slice();\r\n      }\r\n      newArray.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  return newArray;\r\n}\r\n\r\nexport function $push(array) {\r\n  const newItems = arraySlice.call(arguments, 1);\r\n  if (newItems.length) {\r\n    return arrayOp(array, x => arrayPush.apply(x, newItems));\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $unshift(array) {\r\n  const newItems = arraySlice.call(arguments, 1);\r\n  if (newItems.length) {\r\n    return arrayOp(array, x => arrayUnshift.apply(x, newItems));\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $pop(array) {\r\n  if (!array || array.length) {\r\n    return arrayOp(array, x => x.pop());\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $shift(array) {\r\n  if (!array || array.length) {\r\n    return arrayOp(array, x => x.shift());\r\n  }\r\n  return array;\r\n}\r\n\r\nexport function $sort(array, sorter) {\r\n  return arrayOp(array, x => x.sort(sorter));\r\n}\r\n\r\nfunction clone(value) {\r\n  if (value instanceof Array) {\r\n    return value.slice();\r\n  }\r\n  if (value === null || value === undefined || isPlainObject(value)) {\r\n    return Object.assign({}, value);\r\n  }\r\n  return value;\r\n}\r\n\r\nconst isPlainObject = val =>\r\n  !!val && typeof val === \"object\" && val.constructor === Object;\r\n\r\nexport function $remove(array) {\r\n  const items = arraySlice.call(arguments, 1);\r\n  const newArray = array.filter(x => items.indexOf(x) === -1);\r\n  return newArray.length === array.length ? array : newArray;\r\n}\r\n\r\nexport function $swap(current, from, to) {\r\n  const newValue = clone(current);\r\n  const temp = newValue[from];\r\n  newValue[from] = newValue[to];\r\n  newValue[to] = temp;\r\n  return newValue;\r\n}\r\n\r\nexport function $assign(obj) {\r\n  const values = arraySlice.call(arguments, 1);\r\n  if (values.length) {\r\n    let mergedObj = obj;\r\n    values.forEach(value => {\r\n      if (value === null || value === undefined) return;\r\n      for (let key in value) {\r\n        if (value[key] !== mergedObj[key]) {\r\n          if (mergedObj === obj) {\r\n            mergedObj = Object.assign({}, obj);\r\n          }\r\n          mergedObj[key] = value[key];\r\n        }\r\n      }\r\n    });\r\n    return mergedObj;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nfunction createSelectorProxy(context) {\r\n  const proxy = new Proxy(x => undefined, {\r\n    get(target, prop) {\r\n      if (prop === \"__context__\") return context;\r\n      context = context.child(prop);\r\n      return proxy;\r\n    },\r\n    set(target, prop, value) {\r\n      context.apply($set, prop, value);\r\n      return proxy;\r\n    },\r\n    apply(target, thisArg, args) {\r\n      const action = context.path;\r\n      // back to parent node\r\n      context = context.backToParent();\r\n      context.apply.apply(context, [action].concat(args));\r\n      return proxy;\r\n    }\r\n  });\r\n  return proxy;\r\n}\r\n\r\nexport function $set(current) {\r\n  const args = arraySlice.call(arguments, 1);\r\n  if (args.length < 2) {\r\n    return args[0];\r\n  }\r\n  // don't use destructing to improve performance\r\n  const prop = args[0];\r\n  const value = args[1];\r\n  if (current[prop] === value) return current;\r\n  const newValue = clone(current);\r\n  newValue[prop] = value;\r\n  return newValue;\r\n}\r\n\r\nfunction processSubSpec(child, value) {\r\n  // is sub spec\r\n  const spec = value[0];\r\n  const filter = value[1];\r\n  if (spec instanceof Array) {\r\n    // apply for each child\r\n    for (let key of Object.keys(child.value)) {\r\n      // only apply spec for child which is satisfied filter\r\n      if (filter && !filter(child.value[key], key)) {\r\n        continue;\r\n      }\r\n      const newChild = child.child(key);\r\n      newChild.apply.apply(newChild, spec);\r\n    }\r\n  } else {\r\n    for (let key of Object.keys(child.value)) {\r\n      traversal(child.child(key), spec);\r\n    }\r\n  }\r\n}\r\n\r\nfunction traversal(parent, node) {\r\n  for (let pair of Object.entries(node)) {\r\n    const key = pair[0];\r\n    let value = pair[1];\r\n    // convert obj method to custom modifier\r\n    if (value instanceof Function) {\r\n      value = [value];\r\n    }\r\n    const child = parent.childFromPath(key);\r\n    if (value instanceof Array) {\r\n      // is main spec\r\n      if (value[0] instanceof Function || typeof value[0] === \"string\") {\r\n        // is modifier and its args\r\n        child.apply.apply(child, value);\r\n      } else {\r\n        processSubSpec(child, value);\r\n      }\r\n    } else if (isPlainObject(value)) {\r\n      traversal(child, value);\r\n    } else {\r\n      child.apply($set, value);\r\n    }\r\n  }\r\n}\r\n\r\n// a token to determine batch actions\r\nexport function $batch() {\r\n  // do nothing\r\n}\r\n\r\nexport const update = (state, changes) => {\r\n  const root = new Immutable(state);\r\n\r\n  if (changes instanceof Array) {\r\n    if (changes[0] instanceof Array) {\r\n      processSubSpec(root, changes);\r\n    } else {\r\n      root.apply.apply(root, changes);\r\n    }\r\n  } else {\r\n    traversal(root, changes);\r\n  }\r\n\r\n  return root.value;\r\n};\r\n\r\nexport function updatePath(state, ...specs) {\r\n  const root = new Immutable(state);\r\n\r\n  for (let spec of specs) {\r\n    if (spec instanceof Function) {\r\n      spec = [spec];\r\n    }\r\n    const selector = spec[0];\r\n    const args = spec.slice(1);\r\n    const node = selector(createSelectorProxy(root)).__context__;\r\n    if (args.length) {\r\n      node.apply.apply(node, args);\r\n    }\r\n  }\r\n\r\n  return root.value;\r\n}\r\n\r\nexport default update;\r\n\r\nexport const actions = {\r\n  $batch,\r\n  batch: $batch,\r\n  \"=\": $set,\r\n  $assign,\r\n  assign: $assign,\r\n  $pop,\r\n  pop: $pop,\r\n  $push,\r\n  push: $push,\r\n  $remove,\r\n  remove: $remove,\r\n  $set,\r\n  set: $set,\r\n  $shift,\r\n  shift: $shift,\r\n  $sort,\r\n  sort: $sort,\r\n  $splice,\r\n  splice: $splice,\r\n  $toggle,\r\n  toggle: $toggle,\r\n  $unset,\r\n  unset: $unset,\r\n  $unshift,\r\n  unshift: $unshift,\r\n  $swap,\r\n  swap: $swap,\r\n  $removeAt,\r\n  removeAt: $removeAt\r\n};\r\n\r\nfunction cloneIfPossible(callback) {\r\n  return function() {\r\n    arguments[0] = clone(arguments[0]);\r\n    return callback.apply(null, arguments);\r\n  };\r\n}\r\n\r\nexport function define(name, action, disableAutoClone) {\r\n  // define(actionHash, disableAutoClone)\r\n  if (isPlainObject(name)) {\r\n    disableAutoClone = action;\r\n    for (let pair of Object.entries(name)) {\r\n      actions[pair.key] = disableAutoClone\r\n        ? pair.value\r\n        : cloneIfPossible(pair.value);\r\n    }\r\n  } else {\r\n    // define(name, action, disableAutoClone)\r\n    actions[name] = disableAutoClone ? action : cloneIfPossible(action);\r\n  }\r\n}\r\n"]}